<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{{page.title}}</title>
  <meta name="description" content="{{page.description}}" />
  <link rel="canonical" href="{{page.canonical}}" />

  <!-- Open Graph -->
  <meta property="og:title" content="{{page.title}}" />
  <meta property="og:description" content="{{page.description}}" />
  <meta property="og:url" content="{{page.canonical}}" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="{{page.ogImage}}" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{page.title}}" />
  <meta name="twitter:description" content="{{page.description}}" />
  <meta name="twitter:image" content="{{page.ogImage}}" />

  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
<section id="presenter" class="presenter-root">
  <!-- Header -->
  <header class="ln-header">
    <!-- Left: header image -->
    <div class="ln-header-left">
      <img
        id="repHeaderImg"
        src=""
        class="ln-header-image"
        alt=""
        style="display:none;"
      />
    </div>
    <script>
(function () {
  // === Uploaded header storage (must match Builder keys) ===
  const UPLOADED_HEADER_DATAURL_KEY = "LNP_UPLOADED_HEADER_DATAURL_V1";
  const LNP_IDB_NAME = "LNPresentsDB";
  const LNP_IDB_VERSION = 1;
  const LNP_IDB_STORE = "kv";
  const LNP_IDB_KEY = "uploadedHeaderV1";

  const img = document.getElementById("repHeaderImg");
  if (!img) return;

  // Default: hidden until we successfully load something
  img.style.display = "none";
  img.onerror = function () { this.style.display = "none"; };
  img.onload  = function () { this.style.display = ""; };

  function openLnpDb(){
    return new Promise((resolve, reject) => {
      try {
        const req = indexedDB.open(LNP_IDB_NAME, LNP_IDB_VERSION);
        req.onupgradeneeded = () => {
          const db = req.result;
          if (!db.objectStoreNames.contains(LNP_IDB_STORE)) {
            db.createObjectStore(LNP_IDB_STORE);
          }
        };
        req.onsuccess = () => resolve(req.result);
        req.onerror = () => reject(req.error);
      } catch (e) {
        reject(e);
      }
    });
  }

  async function idbGet(key){
    const db = await openLnpDb();
    return new Promise((resolve, reject) => {
      const tx = db.transaction(LNP_IDB_STORE, "readonly");
      const req = tx.objectStore(LNP_IDB_STORE).get(key);
      req.onsuccess = () => {
        try { db.close(); } catch(e){}
        resolve(req.result);
      };
      req.onerror = () => {
        try { db.close(); } catch(e){}
        reject(req.error);
      };
    });
  }

  function setSrc(src){
    if (!src) return;
    img.style.display = "none"; // wait for load
    img.src = src;
  }

  // ======================================================
  // ONLY SOURCES:
  // 1) IndexedDB uploaded header
  // 2) localStorage uploaded header fallback
  // ======================================================
  (async function initHeader(){
    // 1) IndexedDB (preferred)
    try {
      const obj = await idbGet(LNP_IDB_KEY);
      if (obj && obj.dataUrl) {
        setSrc(String(obj.dataUrl));
        return;
      }
    } catch (e) {
      // silently fall through
    }

    // 2) localStorage fallback
    try {
      const dataUrl = localStorage.getItem(UPLOADED_HEADER_DATAURL_KEY) || "";
      if (dataUrl) {
        setSrc(String(dataUrl));
        return;
      }
    } catch (e) {}

    // 3) Nothing found â†’ no header
    img.style.display = "none";
  })();
})();
</script>

    <!-- Center: drawer + export PDF button -->
    <div class="ln-header-center"></div>

    <!-- Right: existing LN logo -->
    <div class="ln-header-right">
      <a class="ln-logo-company">
        <img
          src="./ln-logo.png"
          alt="LexisNexis"
          width="200"
          height="70"
          onerror="this.style.display='none';"
        />
      </a>
    </div>
  </header>

  <div class="drawer">
    <button class="drawer-button" id="drawerCta">
      <span data-key="ui.drawerCta"></span>
    </button>
  </div>

  <button type="button" id="exportPdfBtn" class="exportPdfBtn">
    Export PDF
  </button>

  <main>
    <!-- Hero / Title -->
    <section class="hero">
      <h1 data-key="ui.headline"></h1>
      <p data-key="ui.subhead" class="subhead"></p>
    </section>

    <!-- Term selector -->
    <section class="selector">
      <label class="selector-label" data-key="ui.selectorLabel" id="proposalTitle"></label>
      <div id="termRadios"></div>
    </section>

    <!-- Plans -->
    <section class="plans">
      <div id="plans" class="plans-grid"></div>

      <!-- Card template -->
      <template id="planCardTpl">
        <article class="plan-card">
          <header class="plan-card__header">
            <h3 class="plan-card__title"></h3>
            <p class="plan-card__desc"></p>
          </header>
          <div class="plan-card__terms" hidden>
            <div class="plan-card__terms-title">Plan Terms</div>
            <ul class="plan-card__terms-list"></ul>
          </div>
          <ul class="plan-card__features rte-html"></ul>
          <footer class="plan-card__footer">
            <a class="btn-primary plan-card__cta" rel="noopener noreferrer" target="_blank"></a>
          </footer>
        </article>
      </template>
    </section>
  </main>

  <footer class="site-footer">
    <small>&copy; <span data-key="ui.companyName"></span></small>
  </footer>
</section>

<!-- libs first -->
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js" crossorigin="anonymous"></script>

<!-- your app scripts -->
<script src="./config.js"></script>
<script src="./init.js"></script>
</body>
</html>
